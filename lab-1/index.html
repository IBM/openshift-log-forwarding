
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="IBM Developer">
      
      
        <link rel="canonical" href="https://remkohdev.github.io/workshop-setup/lab-1/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Lab 1. Some Title - Workshop Setup</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CIBM+Plex+Mono&display=fallback">
        <style>:root{--md-text-font-family:"IBM Plex Sans";--md-code-font-family:"IBM Plex Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#forwarding-logs-to-an-external-logging-platform" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Workshop Setup" class="md-header__button md-logo" aria-label="Workshop Setup" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Workshop Setup
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 1. Some Title
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/remkohdev/workshop-setup/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    workshop-setup
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        Welcome
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../pre-work/" class="md-tabs__link md-tabs__link--active">
        Workshop
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../resources/RESOURCES/" class="md-tabs__link">
        References
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Workshop Setup" class="md-nav__button md-logo" aria-label="Workshop Setup" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Workshop Setup
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/remkohdev/workshop-setup/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    workshop-setup
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Welcome
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Welcome" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Welcome
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About the workshop
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Workshop
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Workshop" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Workshop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pre-work/" class="md-nav__link">
        Lab 0. Pre-work
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Lab 1. Some Title
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Lab 1. Some Title
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-setup" class="md-nav__link">
    1. Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-deploy-openshift-logging" class="md-nav__link">
    1. Deploy OpenShift Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-configuring-splunk" class="md-nav__link">
    2. Configuring Splunk
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-deploying-the-fluentd-forwarder" class="md-nav__link">
    3. Deploying the Fluentd Forwarder
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-forwarding-logs" class="md-nav__link">
    4. Forwarding logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          References
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="References" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          References
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resources/RESOURCES/" class="md-nav__link">
        Additional Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resources/CONTRIBUTORS/" class="md-nav__link">
        Contributors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resources/MKDOCS/" class="md-nav__link">
        MkDocs Cheatsheet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resources/ADMIN/" class="md-nav__link">
        Admin Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-setup" class="md-nav__link">
    1. Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-deploy-openshift-logging" class="md-nav__link">
    1. Deploy OpenShift Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-configuring-splunk" class="md-nav__link">
    2. Configuring Splunk
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-deploying-the-fluentd-forwarder" class="md-nav__link">
    3. Deploying the Fluentd Forwarder
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-forwarding-logs" class="md-nav__link">
    4. Forwarding logs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/remkohdev/workshop-setup/edit/master/docs/lab-1/README.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="forwarding-logs-to-an-external-logging-platform">Forwarding logs to an external logging platform<a class="headerlink" href="#forwarding-logs-to-an-external-logging-platform" title="Permanent link">&para;</a></h1>
<p>In this workshop we will explore how to forward logs to an external logging platform through the built in OpenShift Logging service. For this workshop, the logging platform that we will be forwarding to is Spunk, however, for workshop purposes this instance of Splunk will actually also be deployed on your OpenShift cluster.</p>
<h3 id="1-setup">1. Setup<a class="headerlink" href="#1-setup" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Clone the repo</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/odrodrig/openshift-logforwarding-splunk.git
<span class="nb">cd</span> openshift-logforwarding-splunk
</code></pre></div>
</li>
<li>
<p>In the <code>Cloud Shell</code>, download and unzip Helm v3.2.</p>
<div class="highlight"><pre><span></span><code><span class="go">cd $HOME</span>
<span class="go">wget https://get.helm.sh/helm-v3.2.0-linux-amd64.tar.gz</span>
<span class="go">tar -zxvf helm-v3.2.0-linux-amd64.tar.gz</span>
</code></pre></div>
</li>
<li>
<p>Make Helm v3 CLI available in your <code>PATH</code> environment variable.</p>
<div class="highlight"><pre><span></span><code><span class="go">echo &#39;export PATH=$HOME/linux-amd64:$PATH&#39; &gt; $HOME/.bash_profile</span>
<span class="go">source $HOME/.bash_profile</span>
</code></pre></div>
</li>
<li>
<p>Verify Helm v3 installation.</p>
<div class="highlight"><pre><span></span><code><span class="go">helm version --short</span>
</code></pre></div>
<p>outputs,</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>helm version --short
<span class="go">v3.2.0+ge11b7ce</span>
</code></pre></div>
</li>
</ol>
<h2 id="1-deploy-openshift-logging">1. Deploy OpenShift Logging<a class="headerlink" href="#1-deploy-openshift-logging" title="Permanent link">&para;</a></h2>
<p>In OpenShift with the OpenShift Logging operator you are able to create an instance of the EFK stack which includes Elasticsearch for storing logs, Fluentd for collecting logs, and Kibana for displaying logs. We will be exploring how to utilize the built-in EFK stack to gather logs and forward them to Splunk.</p>
<p>In order to forward the logs to Splunk we will need to forward the logs using Fluentd. While the EFK stack includes an instance of Fluentd already, we need to configure a standalone instance of Fluentd to act as our forwarding service to send logs to Splunk.
This process can be done through the OpenShift web console or through the cli. For the purposes of this workshop, we will be using yaml files with the cli to set everything up for us.</p>
<ol>
<li>
<p>First we need to create projects for our OpenShift logging operator and for the Elasticsearch operator.</p>
<div class="highlight"><pre><span></span><code>oc apply -f prereqs/projects.yaml
</code></pre></div>
</li>
<li>
<p>Next, we will need to create the operators. This is done by creating an OperatorGroup and a subscription to both the Elasticsearch operator and the OpenShift Logging operator.</p>
<div class="highlight"><pre><span></span><code>oc apply -f prereqs/operators.yaml
</code></pre></div>
</li>
<li>
<p>Before we proceed we need to verify that the operators are deployed. This is done by looking at the ClusterServiceVersion that was deployed for the Operator when we created the subscriptions. Ensure that for both operators the <code>PHASE</code> column reads <code>Succeeded</code>. This will take a minute to complete. If you try too early you might see a message that says <code>No resources found in openshift-logging namespace.</code></p>
<div class="highlight"><pre><span></span><code>oc get csv -n openshift-logging
</code></pre></div>
<div class="highlight"><pre><span></span><code>NAME                             DISPLAY                            VERSION    REPLACES   PHASE
cluster-logging.5.2.2-21         Red Hat OpenShift Logging          <span class="m">5</span>.2.2-21              Succeeded
elasticsearch-operator.5.1.2-7   OpenShift Elasticsearch Operator   <span class="m">5</span>.1.2-7               Succeeded
</code></pre></div>
</li>
<li>
<p>With the OpenShift Logging operator deployed we now need to create our ClusterLogging instance. Before we run the command to create it, let's take a look at the clusterLogging.yaml file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="s">&quot;logging.openshift.io/v1&quot;</span>
<span class="nt">kind</span><span class="p">:</span> <span class="s">&quot;ClusterLogging&quot;</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="nt">name</span><span class="p">:</span> <span class="s">&quot;instance&quot;</span> 
<span class="nt">namespace</span><span class="p">:</span> <span class="s">&quot;openshift-logging&quot;</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="nt">managementState</span><span class="p">:</span> <span class="s">&quot;Managed&quot;</span>
<span class="c1"># logStore:</span>
<span class="c1">#   type: &quot;elasticsearch&quot;  </span>
<span class="c1">#   retentionPolicy: </span>
<span class="c1">#     application:</span>
<span class="c1">#       maxAge: 1d</span>
<span class="c1">#     infra:</span>
<span class="c1">#       maxAge: 7d</span>
<span class="c1">#     audit:</span>
<span class="c1">#       maxAge: 7d</span>
<span class="c1">#   elasticsearch:</span>
<span class="c1">#     nodeCount: 3 </span>
<span class="c1">#     storage:</span>
<span class="c1">#       storageClassName: &quot;ibmc-block-gold&quot; </span>
<span class="c1">#       size: 200G</span>
<span class="c1">#     resources: </span>
<span class="c1">#       requests:</span>
<span class="c1">#         memory: &quot;8Gi&quot;</span>
<span class="c1">#     proxy: </span>
<span class="c1">#       resources:</span>
<span class="c1">#         limits:</span>
<span class="c1">#           memory: 256Mi</span>
<span class="c1">#         requests:</span>
<span class="c1">#            memory: 256Mi</span>
<span class="c1">#     redundancyPolicy: &quot;SingleRedundancy&quot;</span>
<span class="c1"># visualization:</span>
<span class="c1">#   type: &quot;kibana&quot;  </span>
<span class="c1">#   kibana:</span>
<span class="c1">#     replicas: 1</span>
<span class="nt">collection</span><span class="p">:</span>
    <span class="nt">logs</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;fluentd&quot;</span>  
    <span class="nt">fluentd</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
</code></pre></div>
<p>This ClusterLogging object has three key areas: logStore, visualization, and collection. These correspond to the components of the EFK stack as seen below:</p>
<ul>
<li>logStore = **E**lasticsearch</li>
<li>collection = **F**luentd</li>
<li>visualization = **K**ibana</li>
</ul>
<p>For our lab we are not focusing on using the Elasticsearch and Kibana portions of the clusterLogging object so we have commented them out which will disable them on our cluster. We are only interested in the Fluentd component which allows for log collection and forwarding.</p>
<p><strong>Note:</strong> For this workshop we are using clusters with minimal resources which will not support Elasticsearch's memory requirements.</p>
</li>
<li>
<p>Let's go ahead and deploy our ClusterLogging instance now:</p>
<div class="highlight"><pre><span></span><code>oc apply -f prereqs/clusterLogging.yaml -n openshift-logging
</code></pre></div>
</li>
<li>
<p>Before we continue we will need to verify that the fluentd pods are running</p>
<div class="highlight"><pre><span></span><code>oc get pods -n openshift-logging
</code></pre></div>
<p>Ensure that the 3 fluentd pods all have a status of <code>Running</code> before continuing. </p>
<p>With the fluentd pods running, now we can install splunk. </p>
</li>
</ol>
<h2 id="2-configuring-splunk">2. Configuring Splunk<a class="headerlink" href="#2-configuring-splunk" title="Permanent link">&para;</a></h2>
<p>As mentioned before, for the purposes of this workshop we will be installing Splunk locally on your OpenShift clusters. </p>
<ol>
<li>
<p>Run the following script to install Splunk:</p>
<div class="highlight"><pre><span></span><code>./splunk_install.sh
</code></pre></div>
<p>This will take a moment to complete.</p>
</li>
<li>
<p>Next, let's log in to our Splunk instance through our browser. Run the following to find the address for Splunk:</p>
<div class="highlight"><pre><span></span><code>oc get routes -n splunk
</code></pre></div>
<p>Then copy the address that appears. It should be listed under the HOST/PORT section and start with <code>splunk-splunk...</code>. An example can be seen below:</p>
<p>```bash
NAME     HOST/PORT                                                                                                PATH   SERVICES   PORT   TERMINATION     WILDCARD
splunk   splunk-splunk.oliver-logging-2bef1f4b4097001da9502000c44fc2b2-0000.us-south.containers.appdomain.cloud          splunk     8000   edge/Redirect   None</p>
</li>
<li>
<p>Paste the address that you copied from the earlier command in to your browser in a new tab. This will take you to the Splunk instance that is running in your cluster.</p>
</li>
<li>
<p>You should then see a log in page. Use the following credentials to log in:</p>
<p>username: admin
password: admin123</p>
<p>If asked about Making Spunk Better, click on Skip.
If you are asked about taking a product tour, click on Do not remind me again.</p>
</li>
<li>
<p>Before we send logs to Splunk we need to create an index which will allow us to store log data relating to our cluster. A Splunk index is just a repository for data coming into Splunk.</p>
</li>
<li>
<p>From the Splunk main page, click on <code>Settings</code> at the top right of the page and select <code>Indexes</code></p>
<p><img alt="indexes" src="../images/indexes.png" /></p>
</li>
<li>
<p>On the next page, select the <code>New Index</code> button</p>
<p><img alt="new index" src="../images/newIndex.png" /></p>
</li>
<li>
<p>On the form that appears, name the index <code>openshift</code> and click on the <code>Save</code> button on the bottom of the page.</p>
<p>With our Splunk instance created and configured we now will need to create our standalone instance of Fluentd that will forward the logs.</p>
</li>
</ol>
<h2 id="3-deploying-the-fluentd-forwarder">3. Deploying the Fluentd Forwarder<a class="headerlink" href="#3-deploying-the-fluentd-forwarder" title="Permanent link">&para;</a></h2>
<p>With OpenShift Logging we gain the ability to forward logs to an external logging solution that supports the following:</p>
<ul>
<li>Elasticsearch</li>
<li>FluentForward</li>
<li>Syslog</li>
<li>Kafka</li>
</ul>
<p>Since Splunk isn't available to forward to out of the box, we will need to set up an instance of Fluentd that we can use the <code>FluentForward</code> protocol with to send the logs to which we then will configure to send the logs to Splunk.</p>
<ol>
<li>
<p>Install the Fluentd Forwarder with the following command</p>
<div class="highlight"><pre><span></span><code>helm install --namespace<span class="o">=</span>openshift-logging openshift-logforwarding-splunk charts/openshift-logforwarding-splunk/ --set forwarding.splunk.token<span class="o">=</span>4a8a737d-5452-426c-a6f7-106dca4e813f
</code></pre></div>
<p>The token value above should be the same for everybody. This value was taken from the <code>assets/helm/values/splunk_install.yaml</code> file.</p>
</li>
<li>
<p>Check to see that the <code>openshift-logforwarding</code> pods are running by using the following command:</p>
<div class="highlight"><pre><span></span><code>oc get pods -n openshift-logging
</code></pre></div>
</li>
<li>
<p>This fluentd instance is already configured to forward logs to your splunk instance. This is done through a ConfigMap that contains the information needed to connect with Splunk. To view this configMap, use the following command.</p>
<div class="highlight"><pre><span></span><code>oc describe configmap openshift-logforwarding-splunk -n openshift-logging
</code></pre></div>
<p>This information is passed into the fluentd forwarder pods upon creation. The template used to create this configmap can be found in the repo cloned earlier in the <code>/charts/openshift-logforwarding-splunk/templates/log-forwarding-splunk-configmap.yaml</code> file.</p>
</li>
<li>
<p>That helm chart not only deployed the fluentd forwarding pods but it also created a ClusterLogForwarder object. This Custom Resource is managed by the OpenShift Logging Operator that was installed earlier. </p>
<p>The ClusterLogForwarder allows us to forward logs using any of the methods mentioned at the beginning of this section. For our purposes, we will be forwarding using the <code>fluentForward</code> method.</p>
</li>
<li>
<p>Let's take a look at the ClusterLogForwarder object that was created:</p>
<div class="highlight"><pre><span></span><code>oc describe clusterlogforwarder instance -n openshift-logging
</code></pre></div>
<p>Take a look at the spec fields:</p>
<div class="highlight"><pre><span></span><code><span class="nt">Spec</span><span class="p">:</span>
    <span class="nt">Outputs</span><span class="p">:</span>
        <span class="nt">Name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">openshift-logforwarding-splunk</span>
        <span class="nt">Secret</span><span class="p">:</span>
        <span class="nt">Name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">openshift-logforwarding-splunk</span>
        <span class="nt">Type</span><span class="p">:</span>    <span class="l l-Scalar l-Scalar-Plain">fluentdForward</span>
        <span class="nt">URL</span><span class="p">:</span>     <span class="l l-Scalar l-Scalar-Plain">tls://openshift-logforwarding-splunk.openshift-logging.svc:24224</span>
    <span class="nt">Pipelines</span><span class="p">:</span>
        <span class="nt">Input Refs</span><span class="p">:</span>
            <span class="l l-Scalar l-Scalar-Plain">application</span>
        <span class="nt">Name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">container-logs</span>
        <span class="nt">Output Refs</span><span class="p">:</span>
            <span class="l l-Scalar l-Scalar-Plain">default</span>
            <span class="l l-Scalar l-Scalar-Plain">openshift-logforwarding-splunk</span>
        <span class="nt">Input Refs</span><span class="p">:</span>
            <span class="l l-Scalar l-Scalar-Plain">infrastructure</span>
        <span class="nt">Name</span><span class="p">:</span>  <span class="l l-Scalar l-Scalar-Plain">infra-logs</span>
        <span class="nt">Output Refs</span><span class="p">:</span>
            <span class="l l-Scalar l-Scalar-Plain">default</span>
            <span class="l l-Scalar l-Scalar-Plain">openshift-logforwarding-splunk</span>
</code></pre></div>
<p>From this object we are defining a few things:</p>
<ul>
<li>Outputs: We are pointing to our newly created <code>openshift-logforwarding-splunk</code> instance of fluentd that was created by the helm chart.</li>
<li>Pipelines: We have 2 pipelines which relate to 2 different kinds of logs that we are forwarding: Application logs and infrastructure logs. Notice the <code>Output Refs</code> that are defined. <code>default</code> refers to the built in instance of Elasticsearch that is running on the cluster as part of OpenShift Logging while the <code>openshift-logforwarding-splunk</code> refers to the output defined above which points to the fluentd forwarding instance.</li>
</ul>
</li>
<li>
<p>Before we generate some logs to send over, we need to enable log forwarding. This is done through an annotation to the ClusterLogging object that we created at the beginning of the lab.</p>
<div class="highlight"><pre><span></span><code>oc annotate clusterlogging -n openshift-logging instance clusterlogging.openshift.io/logforwardingtechpreview<span class="o">=</span>enabled
</code></pre></div>
<p>With the Fluentd Forwarder in place and log forwarding enabled, we can now generate some logs to forward.</p>
</li>
</ol>
<h2 id="4-forwarding-logs">4. Forwarding logs<a class="headerlink" href="#4-forwarding-logs" title="Permanent link">&para;</a></h2>
<p>Now let's test out everything we have set up by generating some logs</p>
<ol>
<li>
<p>Create a project where our test application will reside:</p>
<div class="highlight"><pre><span></span><code>oc new-project ruby-app
</code></pre></div>
</li>
<li>
<p>Then create a test ruby application </p>
<div class="highlight"><pre><span></span><code>oc new-app ruby~https://github.com/sclorg/ruby-ex.git
</code></pre></div>
<p>With that a new Ruby application will start to build and generate logs as it goes along.</p>
</li>
<li>
<p>Go back to your browser tab that has Splunk and click on the <code>Apps</code> button at the top left of the page and select <code>Search &amp; Reporting</code>.</p>
<p><img alt="search and reporting" src="../images/searchReporting.png" /></p>
</li>
<li>
<p>This is the page where we can sort through logs that have been sent over. In the search box, enter the following:</p>
<div class="highlight"><pre><span></span><code><span class="nv">index</span><span class="o">=</span><span class="s2">&quot;openshift&quot;</span> kubernetes.namespace_name<span class="o">=</span>ruby-app <span class="p">|</span> table _time kubernetes.namespace_name kubernetes.pod_name message <span class="p">|</span> sort -_time
</code></pre></div>
<p>What this search allows us to do is 3 things:
- Search for all events from our <code>openshift</code> index and namespace named <code>ruby-app</code>
- Create a table with the time of event, namespace the event occurred in, the name of the pod generating the message, and the log message itself.
- Sort the table in descending order of when the even occurred with the newest events at the top.</p>
<p>These are application logs returned from the running container we created.</p>
<p>To view all application logs, you can try the following search:</p>
<div class="highlight"><pre><span></span><code><span class="nv">index</span><span class="o">=</span><span class="s2">&quot;openshift&quot;</span> <span class="nv">log_type</span><span class="o">=</span><span class="s2">&quot;application&quot;</span> <span class="p">|</span> table _time kubernetes.namespace_name kubernetes.pod_name message <span class="p">|</span> sort -_time
</code></pre></div>
</li>
<li>
<p>How about logs pertaining to the health of the actual OpenShift cluster? Try the following search:</p>
<div class="highlight"><pre><span></span><code><span class="nv">index</span><span class="o">=</span><span class="s2">&quot;openshift&quot;</span> <span class="nv">log_type</span><span class="o">=</span><span class="s2">&quot;infrastructure&quot;</span> <span class="p">|</span> table _time kubernetes.namespace_name kubernetes.pod_name message <span class="p">|</span> sort -_time
</code></pre></div>
<p>This search returns infrastructure logs which are generated from OpenShift components in specific namespaces such as openshift-operator-lifecycle-manager, openshift-network-diagnostics, openshift-monitoring, openshift-image-registry, kube-system, and more.</p>
</li>
</ol>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>In this lab we explored OpenShift Logging and how to forward logs to an external logging solution. We deployed Splunk to our cluster and configured a standalone Fluentd instance to forward logs to Splunk. Then, we enabled Log Forwarding and generated some logs to send over to Splunk. Finally, we explored the events that were sent over to Splunk and viewed both application and infrastructure logs from our cluster.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../pre-work/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lab 0. Pre-work" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Lab 0. Pre-work
            </div>
          </div>
        </a>
      
      
        
        <a href="../resources/RESOURCES/" class="md-footer__link md-footer__link--next" aria-label="Next: Additional Resources" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Additional Resources
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 IBM Developer
          </div>
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/ibm" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/ibmdeveloper" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/company/ibm/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.youtube.com/user/developerworks" target="_blank" rel="noopener" title="www.youtube.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://dev.to/ibmdeveloper" target="_blank" rel="noopener" title="dev.to" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>